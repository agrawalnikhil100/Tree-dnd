{"ast":null,"code":"/*!\n * Copyright (C) Microsoft Corporation. All rights reserved.\n */\nimport { __assign, __awaiter, __generator, __rest, __spreadArrays } from \"tslib\";\nimport * as React from 'react';\nimport { useArrayTree } from './useArrayTree';\nexport function useAsyncArrayTree(topLevelItems, onLoadChildren, loadingSubItemFactory, loadMoreSubItemFactory, errorSubItemFactory) {\n  var _this = this;\n\n  if (topLevelItems === void 0) {\n    topLevelItems = [];\n  }\n\n  var _a = useArrayTree(topLevelItems),\n      appendChildrenTo = _a.appendChildrenTo,\n      remove = _a.remove,\n      replace = _a.replace,\n      refresh = _a.refresh,\n      rest = __rest(_a, [\"appendChildrenTo\", \"remove\", \"replace\", \"refresh\"]);\n\n  var augmentChildren = React.useCallback(function (item, children) {\n    return children.map(function (child) {\n      var augmentedItem = child;\n      augmentedItem.level = item !== null ? item.level + 1 : 0;\n      augmentedItem.isFolder = child.isFolder === undefined ? true : child.isFolder;\n      augmentedItem.isLoading = false;\n      augmentedItem.hasLoaded = false;\n      augmentedItem.canLoadMore = false;\n      augmentedItem.loadingError = null;\n      return augmentedItem;\n    });\n  }, []);\n  var load = React.useCallback(function (item, continuationToken) {\n    return __awaiter(_this, void 0, void 0, function () {\n      var loadingSubItem, _a, children, newContinuationToken_1, loadMoreSubItem_1, e_1, errorSubItem_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (item !== null && (item.isLoading || item.hasLoaded && !item.canLoadMore && !item.loadingError)) {\n              throw new Error('item');\n            }\n\n            if (item !== null && !item.canLoadMore && continuationToken) {\n              throw new Error('item');\n            }\n\n            if (item !== null) {\n              item.isLoading = true;\n              item.loadingError = null;\n            }\n\n            loadingSubItem = loadingSubItemFactory ? loadingSubItemFactory(item) : null;\n\n            if (loadingSubItem !== null) {\n              appendChildrenTo(item, [loadingSubItem]);\n            }\n\n            _b.label = 1;\n\n          case 1:\n            _b.trys.push([1, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , onLoadChildren(item, continuationToken)];\n\n          case 2:\n            _a = _b.sent(), children = _a[0], newContinuationToken_1 = _a[1];\n\n            if (item !== null) {\n              item.isLoading = false;\n              item.hasLoaded = true;\n              item.canLoadMore = newContinuationToken_1 !== null;\n              item.loadingError = null;\n            }\n\n            if (loadingSubItem !== null) {\n              remove(loadingSubItem);\n            } // If the item has no children, mark it as a leaf.\n\n\n            if (children.length === 0) {\n              item.isFolder = false;\n              refresh();\n              return [2\n              /*return*/\n              ];\n            }\n\n            loadMoreSubItem_1 = newContinuationToken_1 !== null && loadMoreSubItemFactory !== undefined ? loadMoreSubItemFactory(item, function () {\n              remove(loadMoreSubItem_1);\n              load(item, newContinuationToken_1);\n            }) : null;\n            appendChildrenTo(item, __spreadArrays(augmentChildren(item, children), loadMoreSubItem_1 !== null ? [loadMoreSubItem_1] : []));\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_1 = _b.sent();\n\n            if (item !== null) {\n              item.isLoading = false;\n              item.hasLoaded = true;\n              item.loadingError = e_1;\n            }\n\n            errorSubItem_1 = errorSubItemFactory ? errorSubItemFactory(item, function () {\n              remove(errorSubItem_1);\n              load(item, continuationToken);\n            }) : null;\n\n            if (loadingSubItem !== null && errorSubItem_1 !== null) {\n              replace(loadingSubItem, errorSubItem_1);\n            } else if (loadingSubItem !== null) {\n              remove(loadingSubItem);\n            } else if (errorSubItem_1 !== null) {\n              appendChildrenTo(item, [errorSubItem_1]);\n            }\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [onLoadChildren, appendChildrenTo, remove, refresh]);\n  var loadMore = React.useCallback(function (item, continuationToken) {\n    return __awaiter(_this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (continuationToken === '') {\n          throw new Error('continuationToken');\n        }\n\n        load(item, continuationToken);\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  }, [load]);\n  return __assign({\n    load: load,\n    loadMore: loadMore,\n    remove: remove,\n    replace: replace,\n    appendChildrenTo: appendChildrenTo,\n    refresh: refresh\n  }, rest);\n}","map":{"version":3,"sources":["../../../src/components/Tree/useAsyncArrayTree.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/*!\n * Copyright (C) Microsoft Corporation. All rights reserved.\n */\nimport { __assign, __awaiter, __generator, __rest, __spreadArrays } from \"tslib\";\nimport * as React from 'react';\nimport { useArrayTree } from './useArrayTree';\nexport function useAsyncArrayTree(topLevelItems, onLoadChildren, loadingSubItemFactory, loadMoreSubItemFactory, errorSubItemFactory) {\n    var _this = this;\n    if (topLevelItems === void 0) { topLevelItems = []; }\n    var _a = useArrayTree(topLevelItems), appendChildrenTo = _a.appendChildrenTo, remove = _a.remove, replace = _a.replace, refresh = _a.refresh, rest = __rest(_a, [\"appendChildrenTo\", \"remove\", \"replace\", \"refresh\"]);\n    var augmentChildren = React.useCallback(function (item, children) {\n        return children.map(function (child) {\n            var augmentedItem = child;\n            augmentedItem.level = item !== null ? item.level + 1 : 0;\n            augmentedItem.isFolder = child.isFolder === undefined ? true : child.isFolder;\n            augmentedItem.isLoading = false;\n            augmentedItem.hasLoaded = false;\n            augmentedItem.canLoadMore = false;\n            augmentedItem.loadingError = null;\n            return augmentedItem;\n        });\n    }, []);\n    var load = React.useCallback(function (item, continuationToken) { return __awaiter(_this, void 0, void 0, function () {\n        var loadingSubItem, _a, children, newContinuationToken_1, loadMoreSubItem_1, e_1, errorSubItem_1;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (item !== null && (item.isLoading || (item.hasLoaded && !item.canLoadMore && !item.loadingError))) {\n                        throw new Error('item');\n                    }\n                    if (item !== null && !item.canLoadMore && continuationToken) {\n                        throw new Error('item');\n                    }\n                    if (item !== null) {\n                        item.isLoading = true;\n                        item.loadingError = null;\n                    }\n                    loadingSubItem = loadingSubItemFactory\n                        ? loadingSubItemFactory(item)\n                        : null;\n                    if (loadingSubItem !== null) {\n                        appendChildrenTo(item, [loadingSubItem]);\n                    }\n                    _b.label = 1;\n                case 1:\n                    _b.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, onLoadChildren(item, continuationToken)];\n                case 2:\n                    _a = _b.sent(), children = _a[0], newContinuationToken_1 = _a[1];\n                    if (item !== null) {\n                        item.isLoading = false;\n                        item.hasLoaded = true;\n                        item.canLoadMore = newContinuationToken_1 !== null;\n                        item.loadingError = null;\n                    }\n                    if (loadingSubItem !== null) {\n                        remove(loadingSubItem);\n                    }\n                    // If the item has no children, mark it as a leaf.\n                    if (children.length === 0) {\n                        item.isFolder = false;\n                        refresh();\n                        return [2 /*return*/];\n                    }\n                    loadMoreSubItem_1 = newContinuationToken_1 !== null && loadMoreSubItemFactory !== undefined\n                        ? loadMoreSubItemFactory(item, function () {\n                            remove(loadMoreSubItem_1);\n                            load(item, newContinuationToken_1);\n                        })\n                        : null;\n                    appendChildrenTo(item, __spreadArrays(augmentChildren(item, children), (loadMoreSubItem_1 !== null ? [loadMoreSubItem_1] : [])));\n                    return [3 /*break*/, 4];\n                case 3:\n                    e_1 = _b.sent();\n                    if (item !== null) {\n                        item.isLoading = false;\n                        item.hasLoaded = true;\n                        item.loadingError = e_1;\n                    }\n                    errorSubItem_1 = errorSubItemFactory\n                        ? errorSubItemFactory(item, function () {\n                            remove(errorSubItem_1);\n                            load(item, continuationToken);\n                        })\n                        : null;\n                    if (loadingSubItem !== null && errorSubItem_1 !== null) {\n                        replace(loadingSubItem, errorSubItem_1);\n                    }\n                    else if (loadingSubItem !== null) {\n                        remove(loadingSubItem);\n                    }\n                    else if (errorSubItem_1 !== null) {\n                        appendChildrenTo(item, [errorSubItem_1]);\n                    }\n                    return [3 /*break*/, 4];\n                case 4: return [2 /*return*/];\n            }\n        });\n    }); }, [onLoadChildren, appendChildrenTo, remove, refresh]);\n    var loadMore = React.useCallback(function (item, continuationToken) { return __awaiter(_this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (continuationToken === '') {\n                throw new Error('continuationToken');\n            }\n            load(item, continuationToken);\n            return [2 /*return*/];\n        });\n    }); }, [load]);\n    return __assign({ load: load,\n        loadMore: loadMore,\n        remove: remove,\n        replace: replace,\n        appendChildrenTo: appendChildrenTo,\n        refresh: refresh }, rest);\n}\n//# sourceMappingURL=useAsyncArrayTree.js.map"]},"metadata":{},"sourceType":"module"}