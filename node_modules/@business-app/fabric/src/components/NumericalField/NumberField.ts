/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */

import { INumberFieldProps } from './NumberField.types';
import { NumericalField } from './NumericalField';

/** An editable textfield control that only accepts floating point numbers. */
export class NumberField extends NumericalField<INumberFieldProps> {
  protected isValid(stringValue: string): boolean {
    return isFinite(Number(stringValue)) && this.isOfAcceptablePrecision(stringValue);
  }

  private isOfAcceptablePrecision(stringValue: string): boolean {
    const { maxPrecision } = this.props;
    if (maxPrecision === undefined) {
      // if the user never specified a max precision there isn't one
      return true;
    }

    // TODO
    // In the future when we support globalization
    // we have to consider locales that don't use "," to split
    // decimal numbers
    const [_, fractional] = stringValue.split('.');

    if (!fractional) {
      // if there's no fractional part, then no trimming is needed
      return true;
    }

    return fractional.length <= maxPrecision;
  }
}
